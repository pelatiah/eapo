{% extends 'services_app/index.html' %}
{% load static %}
{% load pending %}

{% block content %}

<style>
.fr {
    float: right;
    margin-left: 10px;
}
.cancel {
    width: 178px;
}
</style>
<div class="container text-dark">
    <h2>Orders</h2>
    <div class="row">
        <div class="orders">
            {% if my_orders %}
            {% for order in orders_list %}
            <table class="table table-striped table-bordered mb-5">
                <thead>
                    <tr>
                        <td>
                            <div>
                                <span>Orders #: {{order.0.order_num}}</span>
                                <span class="fr">Total Service: {{order.1}} ( {{order.2}} Location )</span>
                            </div>
                            <span>{{order.0.date|date:"M d, Y"}}</span>
                            {% if not order.0.complated %}
                            <a href="{% url 'cancel' order.0.id %}" class="btn btn-danger fr cancel ">Cancel order</a>
                            {% else %}
                            {% endif %}
                        </td>
                        <td colspan="2">
                            {%  if order.3.validate_conter_offer %}
                            <span>We counter offer you {{order.2}} locations with {{order.3.label}}</span>
                            <a href="{% url 'accept_offer' order.3.id %}" class="btn btn-success fr cancel">Accepte </a>
                            <a href="{% url 'conter_order_offer' order.0.id %}" class="btn btn-warning fr cancel">Make another offer </a>
                            {% elif order.3.not_accepted %}
                            <td>
                            <span>offer not accepted please call 470 000 4962 for further consideration</span>
                            </td>
                            {% elif order.3.accepted %}
                            <span>{{order.2}} locations accepted</span>
                            <a href="" class="btn btn-success fr cancel">Pay UpFront </a>
                            {% elif order.3 %}
                            <span>{{order.2}} locations is under consideration</span>
                            <a href="{% url 'cancel_order_offer' order.0.id %}" class="fr text-danger ">Withrow</a>
                            <a href="{% url 'edite_order_offer' order.0.id %}" class="fr text-success">Edite</a>
                            
                            {% else %}
                            <span>{{order.2}} locations pending</span>
                            <a href="{% url 'order_offer' order.0.id %}" class="btn btn-success fr cancel">Order Offer </a>
                            {% endif %}
                        </td>
                    </tr>
                  <tr>
                    <th scope="col">Service</th>
                    <th scope="col">Location</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody>
                    {% for service in order.0.services.all %}
                    <tr>
                        <td>
                            <p>{{service.service.title}}</p>
                            <a href="{% url 'orderd_item_det' service.id %}" class="btn btn-secondary">Detials </a>
                        </td>
                        <td>{{service.location.all.count}}</td>

                        {%  if service.my_order_service.get.validate_conter_offer %}
                            <td>
                            <span>We counter offer you {{service.location.all.count}}  locations with {{service.my_order_service.get.label}}</span>
                            <a href="{% url 'conter_order_service_offer' service.my_order_service.get.id %}" class="btn btn-warning fr cancel">Make another offer</a>
                            <a href="{% url 'accept_offer' service.id %}" class="btn btn-success fr cancel">Accepte </a>
                            </td>
                        {% elif service.my_order_service.get.not_accepted %}
                            <td>
                            <span>offer not accepted please call 470 000 4962 for further consideration</span>
                            </td>
                        {% elif service.my_order_service.get.accepted %}
                            <td>
                            <span>{{service.location.all.count}}  locations accepted</span>
                            <a href="" class="btn btn-success fr cancel">Pay UpFront </a>
                            </td>
                        {% elif service.my_order_service.get %}
                            <td>
                            <span>{{service.location.all.count}}  locations is under consideration</span>
                            <a href="{% url 'cancel_order_service_offer' service.id %}" class="fr text-danger ">Withrow</a>
                            <a href="{% url 'edite_order_service_offer' service.id %}" class="fr text-success">Edite</a>
                            </td>
                        
                        {% else %}
                            <td>
                            <span>{{service.location.all|get_locations_num}}  locations pending</span>
                            <a href="{% url 'orderd_service_offer' service.id %}" class="btn btn-success fr cancel">Service Offer </a>
                            </td>
                        {% endif %}
                    </tr>
                  {% endfor %}

                  {% for service in order.0.custom_services.all %}
                  <tr>
                    <td>
                        <p>{{service.title}}</p>
                        <a href="{% url 'orderd_custom_item_det' service.id %}" class="btn btn-secondary">Detials </a>
                    </td>
                    <td>{{service.location.all.count}}</td>
                    

                    {%  if service.my_custom_service.get.validate_conter_offer %}
                        <td>
                        <span>We counter offer you {{service.location.all.count}}  locations with {{service.my_custom_service.get.label}}</span>
                        <a href="{% url 'accept_offer' service.id %}" class="btn btn-success fr cancel">Accepte </a>
                        <a href="{% url 'conter_custom_service_offer' service.my_custom_service.get.id %}" class="btn btn-warning fr cancel">Make another offer </a>
                        </td>
                    
                    {% elif service.my_custom_service.get.not_accepted %}
                        <td>
                        <span>offer not accepted please call 470 000 4962 for further consideration</span>
                        </td>
                    {% elif service.my_custom_service.get.accepted %}
                        <td>
                        <span>{{service.location.all.count}}  locations accepted</span>
                        <a href="" class="btn btn-success fr cancel">Pay UpFront </a>
                        </td>
                    {% elif service.my_custom_service.get %}
                        <td>
                        <span>{{service.location.all.count}}  locations is under consideration</span>
                        <a href="{% url 'cancel_custom_service_offer' service.id %}" class="fr text-danger ">Withrow</a>
                        <a href="{% url 'edite_custom_service_offer' service.id %}" class="fr text-success">Edite</a>
                        </td>
                        
                    {% else %}
                        <td>
                        <span>{{service.location.all|get_locations_num}}  locations pending</span>
                        <a href="{% url 'orderd_custom_service_offer' service.id %}" class="btn btn-success fr cancel">Service Offer </a>
                        </td>
                    {% endif %}
                    
                  </tr>
                  {% endfor %}
                </tbody>
              
              </table>
            {% endfor %}
            {% else %}
            <div class="order-not-exists">
              <h5>You don't have any orders</h5>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}